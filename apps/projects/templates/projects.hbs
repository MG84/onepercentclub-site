{% load templatetag_handlebars %}
{% load i18n %}
{% load static %}

{% tplhandlebars "project_preview" %}

    <li class="project-item">
    
        {{#linkTo 'project' project.getProject }}
            <span class="project-header">
            
            	<figure class="project-image">
                	<img {{bindAttr src="project.image" }} />
            	</figure>
            	
                <span class="project-title">
                	<h3>{{project.title}}</h3>
                    <span class="project-location"><span class="flaticon solid location-pin-1"></span> {{project.country.name}}</span> 
                </span>
            </span>
            
	        <span {{bindAttr class=":project-status phase"}}>
	            {{#if project.isPhasePlan}}
                    <span class="project-phase"><span class="flaticon solid lightbulb-3"></span> <strong>{% trans "New" %}</strong> <em>{% trans "Smart Idea" %}</em></span> 
	            {{/if}}
	
	            {{#if project.isPhaseCampaign}}
                    {{#if project.campaign.money_asked}}
                        <div class="project-fund-amount-slider"><strong style="width: 0%;" class="slider-progress is-in-progress"><em class="slider-percentage">0%</em></strong></div>
                        <span class="project-fund-amount"><strong>&euro;{{localize project.campaign.money_needed}}</strong> <em>{% trans "To go" %}</em></span>
                    {{/if}}
                    {{#if project.campaign.deadline }}
                        <span class="project-days-left"><span class="flaticon solid clock-1"></span> <strong>{{project.campaign.daysToGo}}</strong> <em>{% trans "days" %}</em></span>
                    {{/if}}
	            {{/if}}
	
	            {{#if project.isPhaseAct}}
                    <div class="project-fund-amount-slider"><strong style="width: 100%;" class="slider-progress is-finished"><em class="slider-percentage">100%</em></strong></div>
                    <span class="project-phase"><span class="flaticon solid lightbulb-3"></span> <strong>{% trans "Project funded" %}</strong> <em>{% trans "Being realized" %}</em></strong>
	            {{/if}}
	            
	            {{#if project.isPhaseResults}}
                    <div class="project-fund-amount-slider"><strong style="width: 100%;" class="slider-progress is-finished"><em class="slider-percentage">100%</em></strong></div>
                    <span class="project-phase"><span class="flaticon solid lightbulb-3"></span> <strong>{% trans "Project funded" %}</strong> <em>{% trans "Being realized" %}</em></span>
	            {{/if}}
	            
	            {{#if project.isPhaseRealized}}
	                <span class="project-phase"><span class="flaticon solid lightbulb-3"></span> <strong>{% trans "Project realized" %}</strong> <em>{% trans "See results" %}</em></span>
	            {{/if}}
	        </span>
	        
            <span class="project-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam sed aliquam lacus, at luctus lacus. Pellentesque pellentesque nibh ac lacus mollis, nec fringilla nunc pharetra. Suspendisse et metus at lacus interdum pharetra ac aliquet libero. Donec dignissim et nunc vel gravida. </span>
	        
        {{/linkTo}}
        	        
        {{#if taskCount}}
            <a class="project-tasks"><span class="flaticon solid wrench-1"></span> <strong>{{project.taskCount}}</strong> <em>{% trans "task(s) available" %}</em></a>
        {{/if}}
    </li>


{% endtplhandlebars %}


{% tplhandlebars "project_list" %}

    {{render "projectSearchForm" }}
    <div class="l-section">
        <section class="l-wrapper">
            <article>
            {{#if model.isLoaded}}
                <ul id="search-results">
                    {{#each project in model}}
                        {{render "projectPreview" project}}
                    {{else}}
                        <li class="no-results">{% trans "No projects found." %}</li>
                    {{/each}}
                </ul>
            {{else}}
                <span class="loading-big"><img src="{% get_static_prefix %}images/loading.gif" /> {% trans "Loading projects" %}</span>
            {{/if}}
        </section>
    </div>

{% endtplhandlebars %}


{% tplhandlebars "project_search_form" %}

    <div class="l-section" id="search">
        <section class="l-wrapper">
            <form id="search-form">
                <div class="control">
                    {{view Em.TextField valueBinding="text" placeholder="Search"}}
                    <span class="flaticon stroke zoom-2"></span>
                </div>
                <div class="control">
                    {{view App.ProjectCountrySelectView valueBinding="country" }}
                    <span class="flaticon solid earth-1"></span>
                </div>
                <div class="control">
                    {{view App.ThemeSelectView valueBinding="theme" }}
                    <span class="flaticon stroke tag-2"></span>
                </div>
                <div class="control">
                    {{view App.ProjectPhaseSelectView valueBinding="phase" }}
                    <span class="flaticon stroke flag-1"></span>
                </div>
                <div class="clear-form">
                    <a {{action clearForm}}>
                        <span class="flaticon solid x-2"></span> {% trans "Reset" %}
                    </a>
                </div>
            </form>
        </section>
    </div>

    <div class="l-section">
        <section class="l-wrapper">
            <article id="search-navigation">
            	
            	<header>
                	<h2>{% trans "Results" %} <em>{{controllers.projectList.model.meta.total}}</em></h2>
            	</header>
                
                <div class="search-sort">
                    {% trans "Sort:" %}
                    <a {{action sortOrder 'popularity'}} {{bindAttr class="orderedByPopularity:active"}}>{% trans "Most popular" %}</a>
                    {% comment %}
                        Disabled because the currently approved design does not include sorting by title.
                        Current design: https://www.dropbox.com/s/n34ndim6cdbm7vz/Project-Search-V2.png
                        <a {{action sortOrder 'title'}} {{bindAttr class="orderedByTitle:active"}}>{% trans "Title" %}</a>
                    {% endcomment %}
                    <a {{action sortOrder 'newest'}} {{bindAttr class="orderedByNewest:active"}}>{% trans "Newest" %}</a>
                    <a {{action sortOrder 'needed'}} {{bindAttr class="orderedByNeeded:active"}}>{% trans "Almost funded" %}</a>
                    <a {{action sortOrder 'deadline'}} {{bindAttr class="orderedByDeadline:active"}}>{% trans "Near deadline" %}</a>
                </div>
                
                <div class="search-pagination">
                	<span class="search-showing">{% trans "Showing" %} {{rangeStart}}-{{rangeEnd}}</span>
                	<span class="search-pages-control">
		                {{#if hasPreviousPage}}
		                    <a {{action "previousPage"}} class="previous-page">
		                        <em class="flaticon solid left-circle-2"></em>
		                    </a>
		                {{else}}
		                	<span class="previous-page"><em class="flaticon solid left-circle-2"></em></span>
		                {{/if}}
		                
		                {{#if hasNextPage}}
		                    <a {{action "nextPage"}} class="next-page">
		                        <em class="flaticon solid right-circle-2"></em>
		                    </a>
		                {{else}}
		                	<span class="next-page"><em class="flaticon solid right-circle-2"></em></span>
		                {{/if}}
                	</span>
                </div>
                
            </article>
        </section>
    </div>

{% endtplhandlebars %}

{% tplhandlebars "project" %}

    <div class="l-section" id="project-detail">
        <section class="l-wrapper">
        
            <figure class="project-image l-half">
                <img {{bindAttr src="plan.image.large"}} width="100%" alt="Photo" />
            </figure>

            <article class="l-half">
            
                <ul class="project-phase">
                    <li>{% trans "Pitch" %}</li>
                    <li {{bindAttr class="isPhasePlan:is-current" }}>{% trans "Plan" %}</li>
                    <li {{bindAttr class="isPhaseCampaign:is-current" }}>{% trans "Campaign" %}</li>
                    <li {{bindAttr class="isPhaseAct:is-current" }}>{% trans "Act" %}</li>
                    <li {{bindAttr class="isPhaseResults:is-current" }}>{% trans "Results" %}</li>
                </ul>
                
                <header class="project-title">
                    {{#if plan.country.name}}<span class="project-location"><span class="flaticon solid location-pin-1"></span> {{plan.country.name}}</span>{{/if}}
                    {{#if plan.theme.title}}<span class="project-theme"><span class="flaticon solid tag-2"></span> {{plan.theme.title}}</span>{{/if}}
                    {{view App.SocialShareView classNames="project-share"}}
                	<h1>{{plan.title}}</h1>
                </header>

                <p class="project-description">{{plan.pitch}}</p>
                
            </article>
        </section>

        {{#if isFundable}}
            <section class="l-wrapper">
                <div class="project-status l-full">
                    
                	{{#if campaign.deadline}}
                    <div class="project-days-left">
						<strong><span class="flaticon solid clock-1"></span> {{campaign.daysToGo}}</strong>
						<em>{% trans "days to go" %}</em>
					</div>
					{{/if}}
					
					<div class="project-fund">
                        <p class="project-fund-amount">
                            <strong class="amount-donated">&euro;{{localize campaign.money_donated}}</strong>
                            {% trans "of" %}
                            <strong class="amount-asked">&euro;{{localize campaign.money_asked}}</strong>
                            {% trans "raised" %}
                        </p>
                    
                        <div class="project-fund-amount-slider"><strong style="width: 0%;" class="slider-progress is-in-progress"><em class="slider-percentage">0%</em></strong></div>
					</div>
                    
					<a href='#' {{ action 'addDonation' project }} class="btn btn-primary btn-iconed"><span class="icon">&euro;</span> {% trans "Support project" %}</a>
				</div>
            </section>
        {{/if}}
    </div>

    <div class="l-section" class="project-fund-list">
        <section class="l-wrapper">
            {{view App.ProjectMembersView}}
        </div>
    </div>

    <nav class="l-section" id="project-actions">
        <div class="l-wrapper">
        
            <ul class="tabs">
                <li class="tab-updates">
                    {{#linkTo 'project.index'}}
                        <span class="tab-icon amount">{{wallposts.length}}</span>
                        <strong class="tab-title">
                            {% trans "Updates" %}

                            {{#if wallposts.length}}
                                {{#if wallposts.firstObject.isLoaded}}
                                    <em class="tab-subtitle">{{localize wallposts.firstObject.created formatting="X"}}</em>
                                {{else}}
                                    <em class="tab-subtitle">{% trans "Loading&#8230;" %}</em>
                                {{/if}}
                            {{else}}
                                <em class="tab-subtitle">{% trans "No updates" %}</em>
                            {{/if}}
                        </strong>
                    {{/linkTo}}
                </li>
                <li class="tab-tasks">
                    {{#if taskCount}}
                        {{#linkTo 'projectTaskList'}}
                            <span class="tab-icon">{{taskCount}}</span>
                            <strong class="tab-title">Tasks <em class="tab-subtitle">{% trans "Skills needed" %}</em></strong>
                        {{/linkTo}}
                    {{else}}
                        {{#linkTo 'projectTaskList'}}
                            <span class="tab-icon">0</span>
                            <strong class="tab-title">Tasks <em class="tab-subtitle">{% trans "No skills needed" %}</em></strong>
                        {{/linkTo}}
                    {{/if}}
                </li>
                <li class="tab-plan">
                    {{#linkTo "projectPlan"}}
                        <span class="tab-icon"><span class="flaticon solid document-2"></span></span>
                        <strong class="tab-title">Project Plan <em class="tab-subtitle">{% trans "Read full plan" %}</em></strong>
                    {{/linkTo}}
                </li>
            </ul>
            
        </div>
    </nav>
    {{ outlet }}


{% endtplhandlebars %}


{% tplhandlebars "project_members" %}

    <div class="member-list">
        <ul>
            <li class="member-initiator">
                <ul>
                    <li>
                        <a {{action openInBigBox "userModal" owner }} class="member">
                            <img {{bindAttr src="owner.getAvatar" info="owner.first_name"}} width="45" height="45" />
                            <h4>Initiator</h4>
                            <strong class="member-name">{{owner.full_name}}</strong>
                            <em class="member-organisation">{{organization}}</em>
                        </a>
                    </li>
                </ul>
            </li>
            {% comment %}
            <li class="member-project-team">
                <h4>Project Team</h4>
                <ul>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="owner.picture" info="owner.full_name"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"  info="ciew.content.owner.fullname"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                </ul>
            </li>

            {% endcomment %}

            {{#if team_member}}
                <li class="member-coaches">
                    <h4>Coach</h4>
                    <ul>
                        <li>
                            <a class="member" {{action openInBigBox "userModal" team_member }} {{bindAttr data-content="team_member.full_name"}} data-title="1%Coach" >
                                <img {{bindAttr src="team_member.getAvatar"}} width="45" height="45" alt="Photo" />
                            </a>
                        </li>
                    </ul>
                </li>
            {{/if}}

            {% comment %}

            <li class="member-promotors">
                <h4>Promotors</h4>
                <ul>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquotbottome>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">username
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                </ul>
            </li>

            {% endcomment %}

            {{#unless isPhasePlan}}
                {{render "projectSupporterList"}}
            {{/unless}}
        </ul>
    </div>

{% endtplhandlebars %}


{% tplhandlebars "project_supporter_list" %}

    {{#if supporters.length}}
        <li class="show-all-supporters supporters-amount">
            <a class="member">
                <strong>{{supporters.meta.total}}</strong>
                <br/>
                <em>Total</em>
            </a>
        </li>

        <li class="member-supporters">
            <ul>
                {{#each supporter in controller}}
                    {{view "App.ProjectSupporterView" }}
                {{/each}}
            </ul>
            <h4>{% trans "Supporters" %}</h4>
        </li>
    {{/if}}

{% endtplhandlebars %}


{% tplhandlebars "project_supporter" %}

    {{#if supporter.member}}
        <a class="member" {{action openInBigBox "userModal" supporter.member }} {{bindAttr data-title="supporter.member.full_name" data-content="supporter.time_since"}}>
            <img {{bindAttr src="supporter.member.getAvatar"}} width="45" height="45" alt="Photo" />
        </a>
    {{else}}
        <a class="member" data-title="guest" {{bindAttr data-content="supporter.time_since"}}>
            <img src="/static/assets/images/default-avatar.png" width="45" height="45" alt="Photo" />
        </a>
    {{/if}}

{% endtplhandlebars %}


{% tplhandlebars "project_plan" %}

    <section class="l-wrapper">
        <div id="project-plan">
            
            <header>
            	<h1>{% trans "Project Plan" %}</h1>
            </header>
           
            {{#if description}}
            	<article>
            	<h2>{% trans "Why, what and how?" %}</h2>
				<p>{{{description}}}</p>
				</article>
			{{/if}}
			
			{{#if effects}}
				<article>
            	<h2>{% trans "Effects" %}</h3>
            	<p>{{{effects}}}</p>
            	</article>
            {{/if}}
			
			{{#if future}}
            	<article>
            	<h2>{% trans "Future" %}</h2>
				<p>{{{future}}}</p>
            	</article>
			{{/if}}
				
			{{#if forWho}}
				<article>
            	<h2>{% trans "For who?" %}</h2>
				<p>{{{forWho}}}</p>
				</article>
			{{/if}}
			
			{{#if reached}}
				<article>
            	<h2>{% trans "People reached" %}</h2>
				<p>{{{reached}}}</p>
				</article>
			{{/if}}

			{{#if country.name}}
				<article>
            	<h2>{% trans "Location" %}</h3>
				<p>{{country.name}}, {{country.subregion}}</p>
				<img {{bindAttr src="view.staticMap"}} />
				</article>
			{{/if}}
			
			{{#if organization.name}}
				<article>
            	<h2>{% trans "Organisation" %}</h2>
				<h3>{{organization.name}}</h3>
				<p>{{organization.description}}</p>
				
				<ul>
                {{#if organization.website}}
                    <li><a hef="{{organization.website}}"><span class="flaticon solid link-1"></span> {{organization.website}}</a><li>
                {{/if}}
                {{#if organization.twitter}}
                    <li><a hef="http://twitter.com/{{organization.twitter}}"><span class="flaticon social twitter-3"></span> {{organization.twitter}}</a><li>
                {{/if}}
                {{#if organization.facebook}}
                    <li><a hef="http://facebook.com/{{organization.facebook}}"><span class="flaticon social facebook-3"></span> {{organization.facebook}}</a><li>
                {{/if}}
                {{#if organization.skype}}
                    <li><a hef="callto:{{organization.skype}}"><span class="flaticon social skype-2"></</span>> {{organization.skype}}</a><li>
                {{/if}}
				</article>	
            {{/if}}
                
        </div>
    </section>

{% endtplhandlebars %}