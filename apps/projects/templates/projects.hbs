{% load templatetag_handlebars %}
{% load i18n %}
{% load static %}

{% tplhandlebars "project_preview" %}

    <li class="item item-project">
        <a {{action showProject project.id href=true}}>
            <div class="header">
                <div {{bindAttr class=":label phase"}}></div>
                <img {{bindAttr src="project.image" }} />
                <h3>
                    {{project.title}}
                </h3>
            </div>
        </a>
        <div class="status">
            {{#if project.isPhaseCampaign}}
                <div class="donate-status">
                    <p class="donate-amount">
                        <span class="donated">&euro;{{localize project.campaign.money_donated}}</span>
                        {% trans "of" %}
                        <span class="asked">&euro;{{localize project.campaign.money_asked}}</span>
                        {% trans "raised" %}
                    </p>
                    <span class="donate-slider"><strong style="width: 0;" class="donate-progress">&nbsp;</strong></span>
                </div>
                {{ project.campaign.daysToGo }} {% trans "days left" %}
            {{/if}}
        </div>
    </li>


{% endtplhandlebars %}


{% tplhandlebars "project_list" %}

    {{render "projectSearchForm" }}

    <div class="container">
        <section class="wrapper">
            <article>
                <header>
                    {{#if model.isLoaded}}
                        <ul class="results">
                            {{#each project in model}}
                                {{render "projectPreview" project}}
                            {{else}}
                                <li>{% trans "No projects found." %}</li>
                            {{/each}}
                        </ul>
                    {{else}}
                        <img src="{% get_static_prefix %}images/loading.gif" height="16px" /> {% trans "loading projects" %}
                    {{/if}}
                </header>
            </article>
        </section>
    </div>

{% endtplhandlebars %}


{% tplhandlebars "project_search_form" %}


    <div class="container section">
        <section class="wrapper">
            <article class="search-form">
                <div class="control">
                    <em class="icon icon-search"></em>
                    {{view Em.TextField valueBinding="text" placeholder="Text search" }}
                </div>
                <div class="control">
                    <em class="icon icon-globe"></em>
                    {{view App.ProjectCountrySelectView valueBinding="country" placeholder="Text search" }}
                </div>
                <div class="control">
                    <em class="icon icon-leaf"></em>
                    {{view App.ThemeSelectView valueBinding="theme" placeholder="Text search" }}
                </div>
                <div class="control">
                    <em class="icon icon-cog"></em>
                    {{view App.ProjectPhaseSelectView valueBinding="phase" }}
                </div>
            </article>
        </section>
    </div>

    <div class="container">
        <section class="wrapper">
            <article class="navigation">
                {{#if hasPreviousPage}}
                    <a {{action "previousPage"}} class="previous-page button-link">
                        <em class="icon-chevron-left"></em> {% trans "Previous page" %}
                    </a>
                {{/if}}
                {{#if hasNextPage}}
                    <a {{action "nextPage"}} class="next-page button-link">
                        {% trans "Next page" %} <em class="icon-chevron-right"></em>
                    </a>
                {{/if}}
                <div class="ordering button-lin">
                    {% trans "Sort:" %}
                    <a {{action sortOrder 'title'}} {{bindAttr class="orderedByTitle:active"}}>{% trans "Title" %}</a>
                    <a {{action sortOrder 'newest'}} {{bindAttr class="orderedByNewest:active"}}>{% trans "Newest" %}</a>
                    <a {{action sortOrder 'deadline'}} {{bindAttr class="orderedByDeadline:active"}}>{% trans "Near deadline" %}</a>
                    <a {{action sortOrder 'money_asked'}} {{bindAttr class="orderedByDeadline:active"}}>{% trans "Money asked" %}</a>

                    {# <a {{action sortOrder 'needed'}} {{bindAttr class="orderedByNeeded:active"}}>{% trans "Almost funded" %}</a> #}
                </div>


            </article>
        </section>
    </div>

{% endtplhandlebars %}


{% tplhandlebars "project" %}

    <div class="section" id="detail">
        <div class="darken-background"></div>
        <section class="wrapper">
            <figure class="media">
                <img {{bindAttr src="plan.image.large"}} width="100%" alt="Photo" />
            </figure>

            <article>
                <div class="project-meta">
                    <span class="location"><em class="flaticon solid location-pin-1"></em> {{plan.country.name}}, {{plan.country.subregion}}</span>
                    
                    <em class="flaticon solid tag-1"></em>
                    <ul class="tags">
                        {{#each tag in plan.tags}}
                            <li>{{tag.id}}</li>
                        {{/each}}
                    </ul>
                </div>

                <h1 class="project-title">
                    {{plan.title}}
                </h1>

                <p class="project-description">{{plan.pitch}}</p>


                {{#if isFundable}}
                    <div class="status-box">
                        <div class="donate-status">
                            <p class="donate-amount">
                                    <span class="donated">&euro;{{localize campaign.money_donated}}</span>
                                    {% trans "of" %}
                                    <span class="asked">&euro;{{localize campaign.money_asked}}</span>
                                    {% trans "raised" %}
                            </p>
                            <span class="donate-slider"><strong style="width: 40%;" class="donate-progress is-in-progress"><em class="donate-percentage">40%</em></strong></span>
                        </div>

                        <p class="donate-days-left">

                            <strong><em class="flaticon solid clock-1"></em> ??</strong>

                            <em>{% trans "days to go" %}</em>
                        </p>
                    </div>
                {{/if}}

            </article>

        {{view App.ProjectMembersView}}

        </section>

    </div>

    <nav id="project-actions" class="section">

        <div class="wrapper">

            <ul class="tabs">
                <li class="tab-updates">
                    {{#linkTo "project.index"}}
                        <span class="tab-icon amount">{{wallposts.length}}</span>
                        <strong class="tab-title">
                            {% trans "Project Updates" %}

                            {{#if wallposts.length}}
                                {{#if wallposts.firstObject.isLoaded}}
                                    <em class="tab-subtitle">{% trans "Last:" %} {{localize wallposts.firstObject.created formatting="X"}} </em>
                                {{else}}
                                    <em class="tab-subtitle">{% trans "..." %}</em>
                                {{/if}}
                            {{else}}
                                <em class="tab-subtitle">{% trans "No updates yet" %}</em>
                            {{/if}}
                        </strong>
                    {{/linkTo}}
                </li>
                <li class="tab-tasks">
                    {{#linkTo "projectTaskList"}}
                        <span class="tab-icon"><em class="flaticon solid wrench-1"></em></span>
                        <strong class="tab-title">Tasks <em class="tab-subtitle">Expertise needed</em></strong>
                    {{/linkTo}}
                </li>
                <li class="tab-plan">
                    {{#linkTo "projectPlan"}}
                        <span class="tab-icon"><em class="flaticon solid document-2"></em></span>
                        <strong class="tab-title">Project Plan <em class="tab-subtitle">Read full plan</em></strong>
                    {{/linkTo}}
                </li>
            </ul>

            <div class="project-action">
                {{#if isFundable}}
                    {{#linkTo "currentOrder.addDonation" this class="btn btn-primary btn-iconed right"}}
                        <em class="icon icon-money"></em> {% trans "Support this project" %}
                    {{/linkTo}}
                {{else}}
                {{/if}}
            </div>

        </div>

    </nav>
    {{ outlet }}


{% endtplhandlebars %}


{% tplhandlebars "project_members" %}

    <div class="member-box">
        <ul>
            <li class="member-initiator">
                <h4>Initiator</h4>
                <ul>
                    <li>
                        <a {{action openInBigBox "userModal" owner }} class="member">
                            <img {{bindAttr src="owner.getAvatar" info="owner.first_name"}} width="45" height="45" />
                            <strong class="member-name">{{owner.full_name}}</strong>
                            <em class="member-organisation">{{organization}}</em>
                        </a>
                    </li>
                </ul>
            </li>
            {% comment %}
            <li class="member-project-team">
                <h4>Project Team</h4>
                <ul>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="owner.picture" info="owner.full_name"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"  info="ciew.content.owner.fullname"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                </ul>
            </li>

            {% endcomment %}

            {{#if team_member}}
                <li class="member-coaches">
                    <h4>Coach</h4>
                    <ul>
                        <li>
                            <a class="member" {{action openInBigBox "userModal" team_member }} {{bindAttr data-content="team_member.full_name"}} data-title="1%COACH" >
                                <img {{bindAttr src="team_member.getAvatar"}} width="45" height="45" alt="Photo" />
                            </a>
                        </li>
                    </ul>
                </li>
            {{/if}}

            {% comment %}

            <li class="member-promotors">
                <h4>Promotors</h4>
                <ul>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquotbottome>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="member">
                            <img {{bindAttr src="view.content.owner.picture"}} width="45" height="45" alt="Photo" />
                            <span class="popup">username
                                <span class="action"><strong>Marieke</strong> just donated</span>
                                <span class="comment"><blockquote>Great Project, go for it!</blockquote></span>
                            </span>
                        </a>
                    </li>
                </ul>
            </li>

            {% endcomment %}

            {{#if isPhaseCampaign}}
                <li class="member-supporters">
                    <h4>{% trans "Supporters" %}</h4>
                    {{render "projectSupporterList"}}
                </li>
                <li class="show-all-supporters supporters-amount" class="not-implemented">
                    <a href="#" class="member">
                        <strong>{{supporters_count}}</strong>
                        <br/>
                        <em>Total</em>
                    </a>
                </li>
            {{/if}}
        </ul>
    </div>

{% endtplhandlebars %}


{% tplhandlebars "project_supporter_list" %}
    <ul>
        {{#each supporter in controller}}
            {{view "App.ProjectSupporterView" }}
        {{/each}}
    </ul>
{% endtplhandlebars %}


{% tplhandlebars "project_supporter" %}
    {{#if supporter.member}}
        <a class="member" {{bindAttr data-title="supporter.member.full_name" data-content="supporter.time_since"}}>
            <img {{bindAttr src="supporter.member.getAvatar"}} width="45" height="45" alt="Photo" />
        </a>
    {{else}}
        <a class="member" data-title="guest" {{bindAttr data-content="supporter.time_since"}}>
            <img src="/static/assets/images/default-avatar.png" width="45" height="45" alt="Photo" />
        </a>
    {{/if}}

{% endtplhandlebars %}


{% tplhandlebars "project_plan" %}

    <section class="wrapper">
        <div class="wall">
            <article>
                <h3>{% trans "Project plan" %}</h3>
                {{theme.title}}<br/>
                {{#each tag in tags}}
                    <a>
                        {{tag.id}}
                    </a>
                {{/each}}

                <h3>{% trans "Why, what and how?" %}</h3>
                {{{description}}}

                <h3>{% trans "Effects" %}</h3>
                {{{effects}}}

                <h3>{% trans "Future" %}</h3>
                {{{future}}}

                <h3>{% trans "For who?" %}</h3>
                {{{forWho}}}

                <h3>{% trans "People reached" %}</h3>
                {{{reached}}}

                <h3>{% trans "Why, what, how?" %}</h3>
                {{{description}}}

                <h3>{% trans "Location" %}</h3>
                {{country.name}}, {{country.subregion}}<br />
                <img {{bindAttr src="view.staticMap"}} />

                <h3>{% trans "Organisation" %}</h3>
                {{organization.name}}<br/>
                {{organization.description}}<br/>
                {{#if organization.website}}
                    <span class="icon-link"></span> {{organization.website}}<br/>
                {{/if}}
                {{#if organization.twitter}}
                    <span class="icon-twitter"></span> {{organization.twitter}}<br/>
                {{/if}}
                {{#if organization.facebook}}
                    <span class="icon-facebook"></span> {{organization.facebook}}<br/>
                {{/if}}
                {{#if organization.skype}}
                    <span class="icon-skype"></span> {{organization.skype}}<br/>
                {{/if}}

            </article>
        </div>

        <div class="sidebar grey task-detail">
            <h3>{{ controller.model.length }} {% trans "Project Plan" %}</h3>
            <ul>
                <li>Description</li>
                <li>Budget</li>
                <li>Theme</li>
            </ul>
        </div>

    </section>

{% endtplhandlebars %}