{% load templatetag_handlebars %}
{% load i18n %}


{% tplhandlebars "wallpost_form_container" %}

    <section class="wrapper" id="wallpost-form">
        <header>
            <h2>{% trans "Comments & Updates" %}</h2>
        </header>
        
        {{#if view.user.username }}
            {{#if view.isOwner }}
                {{view App.MediaWallPostFormView}}
            {{else}}
                {{view App.TextWallPostFormView}}
            {{/if}}
        {{else}}
            <form>{% trans "Login to leave a comment." %}</form>
        {{/if}}
    </section>

{% endtplhandlebars %}


{% tplhandlebars "media_wallpost_form" %}

    <fieldset>
        <ul>
            <li>
                {{#if view.wallpost.errors.title}}
                    <span class="error">{{view.wallpost.errors.title}}</span>
                {{/if}}
                <label for="wallpost-title" class="inline">
                    {% trans "Title of your update." %}
                </label>
                {{view Ember.TextField valueBinding="view.wallpost.title" id="wallpost-title" name="wallpost-title"}}
            </li>
            <li>
                {{#if  view.wallpost.errors.text}}
                    <span class="error">{{view.wallpost.errors.text}}</span>
                {{/if}}
                <label for="wallpost-update" class="inline">
                    {% trans "Your update." %}
                </label>
                {{view Ember.TextArea valueBinding="view.wallpost.text" cols="50" rows="4" name="wallpost-update" id="wallpost-update"}}
            </li>
            <li>
                {{#if view.wallpost.errors.video_url}}
                    <span class="error">{{view.wallpost.errors.video_url}}</span>
                {{/if}}
                <label for="wallpost-video" class="inline">
                    {% trans "Link to video on YouTube or Vimeo." %}
                </label>
                {{view Ember.TextField valueBinding="view.wallpost.video_url" id="wallpost-video" name="wallpost-video"}}
            </li>
            <li>
                {{#if view.wallpost.errors.photo}}
                    <span class="error">{{view.wallpost.errors.photo}}</span>
                {{/if}}
                <label for="wallpost-photo">{% trans "Upload & add Photo's" %} <small>{% trans "(620 x 380 minimum for best results)" %}</small></label>
{# TODO: Implement multi photo upload #}
{#                <span class="fileinput-button image">#}
{#                    <input id="wallpost-photos" class="fileupload" type="file" name="wallpost-photos[]" data-url="server/" multiple>#}
{#                </span>#}
                {{view App.UploadFileView id="wallpost-photo" name="wallpost-photo" accept="image/*"}}
            </li>
        </ul>
    </fieldset>

    <button type="submit">Post Update</button>

{% endtplhandlebars %}


{% tplhandlebars "text_wallpost_form" %}
    <fieldset>
        <ul>
            <li>
                {{#if view.wallpost.errors.text}}
                    <span class="error">{{view.wallpost.errors.text}}</span>
                {{/if}}
                <label for="wallpost-update" class="inline">{% trans "Leave your reaction here" %}</label>
                {{view Ember.TextArea valueBinding="view.wallpost.text" cols="50" rows="4" name="wallpost-update" id="wallpost-update"}}
            </li>
        </ul>
    </fieldset>
    <button type="submit">{% trans "Post Reaction" %}</button>
{% endtplhandlebars %}


{% tplhandlebars "wallpost" %}
    <header>
        <h3>{{view.content.title}}</h3>
        <small class="timestamp">{{view.content.timesince}} {% trans "ago" %}</small>
        <a href="#" class="user initiator">
            <span class="user-img"><img {{bindAttr src="view.content.author.picture"}} width="100%" alt="Avatar" /></span>
            <strong>{{view.content.author.full_name}}</strong> <em class="not-implemented">{% trans "Project Initiator" %}</em>
        </a>

        {{#if view.isAuthor}}
            <ul class="manage">
                <li class="manage-edit not-implemented"><a href="#">{% trans "Edit" %}</a></li>
                <li class="manage-remove"><a {{action "deleteWallPost" target="view"}}>{% trans "Delete" %}</a></li>
            </ul>
        {{/if}}
    </header>

    <div class="content">

        {{#if view.content.video_html}}
            <div class="video">{{{view.content.video_html}}}</div>
        {{/if}}

        {{view.content.text}}

        {# This is temporary and will go away when we figure out how to upload related photos. #}
        {{#if view.content.photo}}
            <div class="photo-viewer">
                <span class="photo"><img {{bindAttr src="view.content.photo"}} width="100%" alt="Gallery" /></span>
            </div>
        {{/if}}

        {# TODO: Implement multi photo viewer #}
        {{#if view.content.photos}}
            <div class="photo-viewer">
                <span class="photo"><a href="#"><img src="/static/assets/dummy/wallpost-image.jpg" width="100%" alt="Gallery" /></a></span>
                <ul>
                    <li><a href="#"><img src="/static/assets/dummy/wallpost-thumb.jpg" width="100%" alt="Thumbnail" /></a></li>
                    <li><a href="#"><img src="/static/assets/dummy/wallpost-thumb.jpg" width="100%" alt="Thumbnail" /></a></li>
                    <li><a href="#"><img src="/static/assets/dummy/wallpost-thumb.jpg" width="100%" alt="Thumbnail" /></a></li>
                    <li><a href="#"><img src="/static/assets/dummy/wallpost-thumb.jpg" width="100%" alt="Thumbnail" /></a></li>
                    <li><a href="#"><img src="/static/assets/dummy/wallpost-thumb.jpg" width="100%" alt="Thumbnail" /></a></li>
                    <li class="more"><a href="#"><strong>6</strong> more photos</a></li>
                </ul>
            </div>
        {{/if}}

    </div>

    <!-- reaction-box -->
    <div class="reaction-box">

        <form action="#" method="post" class="reaction-form">
            <fieldset>
                <span class="user-img"><img {{bindAttr src="view.user.picture"}} width="100%" alt="Avatar" /></span>
                <label for="reaction-1" class="inline">
                    {# TODO: Create proper way to check for authenticated user. #}
                    {{#if view.user.first_name }}
                        Hey {{view.user.first_name}}, leave a comment behind!
                    {{else}}
                        {# TODO: Figure out a way to do composed translations - fragment sentences are hard for translators to deal with. #}
                        <a href="/accounts/login">{% trans "Login" %}</a> {% trans "to leave a comment." %}
                    {{/if}}
                </label>
                <textarea id="reaction-1" name="reaction"></textarea>
            </fieldset>

            <button type="submit" id="reaction-post">{% trans "Post" %}</button>
        </form>

        <ul class="reaction-actions">
            <li><a class="toggle-reactions" data-content="2 Comments" data-content-hover="Show comments" data-content-toggled="2 Comments" data-content-toggled-hover="Hide comments">2 Comments</a></li>
            <li><a class="toggle-love" data-content="22 love this" data-content-hover="Show your love!" data-content-toggled="23 - You loved this" data-content-toggled-hover="Unlove?">22 love this</a></li>
            <li class="share">
                <strong>Share this</strong>
                <ul class="share-actions">
                    <li class="share-facebook">Share on Facebook</li>
                    <li class="share-twitter"><a href="#">Share on Twitter</a></li>
                    <li class="share-url"><code>http://1pr.cc/237429/</code><a href="#" class="share-url-copy">Copy</a></li>
                </ul>
            </li>
        </ul>

        <ul class="reactions">
            {{#each view.content.reactions }}
                <li>
                    <span class="user-img"><img {{bindAttr src="this.author.picture"}} width="100%" alt="Avatar" /></span>
                    <div class="reaction">
                        <a href="#" class="user">
                            {%  trans "By" %} <strong>{{this.author.full_name}}</strong>
                            <em>{%  trans "Member" %}</em> <small>{{this.timesince}} {%  trans "ago" %}</small>
                        </a>
                        <p>{{this.reaction}}</p>
                    </div>
                </li>
            {{/each}}
       </ul>

    </div>
    <!-- end: reaction-box -->

{% endtplhandlebars %}